<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prompt Maker â€” Multi-Expert (Pro UI)</title>

<!-- Google font (works offline when cached; still safe) -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- EXIF reader -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>

<style>
  :root{
    --bg: #0f1724;
    --card: #0b1220;
    --accent: #3b82f6;
    --muted: #94a3b8;
    --glass: rgba(255,255,255,0.04);
    --success: #10b981;
    --danger: #ef4444;
    --radius: 12px;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color-scheme: dark;
  }
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#081029 0%, #08121a 60%);color:#e6eef8}
  .wrap{max-width:1150px;margin:28px auto;padding:20px}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  .brand{
    background:linear-gradient(135deg,var(--accent),#7dd3fc);
    padding:10px;border-radius:10px;color:#00122a;font-weight:800;
    box-shadow:0 6px 20px rgba(59,130,246,0.12);
    min-width:74px;text-align:center
  }
  h1{font-size:20px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .layout{display:grid;grid-template-columns:1fr 420px;gap:18px}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius);padding:14px;border:1px solid rgba(255,255,255,0.03);
    box-shadow:0 6px 18px rgba(2,6,23,0.6);
  }

  label.field{display:block;font-weight:600;font-size:13px;margin-bottom:6px}
  input[type="file"]{display:block}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  input[type="text"], input[type="number"], textarea, select{
    width:100%;background:transparent;border:1px solid rgba(255,255,255,0.04);
    color:var(--muted);padding:10px;border-radius:8px;outline:none;font-size:14px;
  }
  input::placeholder, textarea::placeholder{color:#6b7280}
  textarea{min-height:120px;resize:vertical}
  #preview{max-width:100%;border-radius:10px;margin-top:10px;border:1px solid rgba(255,255,255,0.03)}

  .experts-grid{
    display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px;
  }
  .expert{
    background:var(--glass);padding:10px;border-radius:8px;display:flex;align-items:center;gap:10px;
    border:1px solid rgba(255,255,255,0.02);
    cursor:pointer;user-select:none;
  }
  .expert input{transform:scale(1.05)}
  .expert span{font-size:13px;color:#dbeafe}

  .controls{display:flex;gap:10px;margin-top:12px}
  .btn{padding:10px 12px;border-radius:9px;border:none;cursor:pointer;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,var(--accent),#60a5fa);color:#021026}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .btn-danger{background:linear-gradient(90deg,var(--danger),#fb7185);color:#fff}

  .small-muted{font-size:13px;color:var(--muted);margin-top:8px}

  /* right column */
  .meta{display:grid;gap:8px}
  .section-title{font-weight:700;color:#dbeafe;margin-bottom:6px}
  .output{background:linear-gradient(180deg,rgba(0,0,0,0.24), rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);color:#cfe8ff}
  .output textarea{background:transparent;color:#e6f2ff;height:250px}

  .inline-actions{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(59,130,246,0.12);color:#bfdbfe;font-weight:700;font-size:12px}

  @media (max-width:980px){
    .layout{grid-template-columns:1fr;gap:12px}
    .experts-grid{grid-template-columns:repeat(1,1fr)}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">SPM</div>
      <div>
        <h1>Prompt Maker â€” Multi-Expert (Professional UI)</h1>
        <p class="lead">Upload foto â†’ pilih satu/multiple ahli â†’ Generate Prompt (siap paste ke ChatGPT). Jaga privasi: tidak ada upload server.</p>
      </div>
      <div style="margin-left:auto" class="badge">v2 â€” multi expert</div>
    </header>

    <div class="layout">
      <!-- LEFT: input -->
      <div class="card">
        <div>
          <label class="field">1) Ambil foto (kamera)</label>
          <input id="cameraInput" type="file" accept="image/*" capture="environment">
        </div>

        <div style="margin-top:12px">
          <label class="field">2) Upload dari galeri</label>
          <input id="galleryInput" type="file" accept="image/*">
          <img id="preview" alt="preview image" style="display:none">
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px">
          <div>
            <label class="field">Latitude</label>
            <input id="lat" type="text" placeholder="otomatis dari EXIF atau GPS">
          </div>
          <div>
            <label class="field">Longitude</label>
            <input id="lon" type="text" placeholder="otomatis dari EXIF atau GPS">
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px">
          <div>
            <label class="field">Timestamp</label>
            <input id="timestamp" type="text" placeholder="otomatis jika tersedia">
          </div>
          <div>
            <label class="field">Nama lokasi / keterangan</label>
            <input id="place" type="text" placeholder="mis: PT Asusa - Pulo Gadung">
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="getGeoBtn" class="btn btn-ghost">Ambil GPS Perangkat</button>
          <button id="clearImageBtn" class="btn btn-ghost">Clear</button>
        </div>

        <div style="margin-top:14px">
          <label class="field">3) Pilih Ahli (boleh pilih multiple)</label>
          <div class="experts-grid" id="expertsGrid">
            <!-- checkboxes injected here -->
          </div>
          <div class="small-muted">Pilih kombinasi ahli yang kamu butuhkan. Prompt nanti akan memerintahkan AI bertindak sebagai semua ahli terpilih.</div>
        </div>

        <div style="margin-top:14px">
          <label class="field">4) Catatan tambahan (opsional)</label>
          <textarea id="note" placeholder="mis: gerbang rusak, lampu mati, mobil mencurigakan"></textarea>
        </div>

        <div class="controls" style="margin-top:12px">
          <button id="generateBtn" class="btn btn-primary">Generate Prompt</button>
          <button id="genExampleBtn" class="btn btn-ghost">Generate Example Output</button>
          <button id="copyPromptBtn" class="btn btn-ghost">Copy Prompt</button>
          <button id="copyExampleBtn" class="btn btn-ghost">Copy Example</button>
          <button id="downloadBtn" class="btn btn-ghost">Download Prompt</button>
        </div>

        <div class="small-muted" style="margin-top:10px">Hasil prompt muncul di panel kanan. Gunakan tombol "Generate Example Output" untuk melihat contoh SOP tanpa ChatGPT.</div>
      </div>

      <!-- RIGHT: output -->
      <div class="card">
        <div class="meta">
          <div>
            <div class="section-title">Prompt (siap copy â†’ paste ke ChatGPT)</div>
            <div class="output">
              <textarea id="promptOutput" placeholder="Tekan Generate Prompt untuk membuat prompt..." readonly></textarea>
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="section-title">Contoh Output (Mocked â€” SOP Step-by-step)</div>
            <div class="output">
              <textarea id="exampleOutput" placeholder="Tekan Generate Example Output untuk melihat contoh SOP..." readonly></textarea>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
            <button id="speakExampleBtn" class="btn btn-primary">ðŸ”Š Baca Contoh</button>
            <div class="small-muted">TTS menggunakan Web Speech API (jika browser mendukung).</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========= Expert list: original 11 + new 10 = 21 experts ========= */
const EXPERTS = [
  {id:'exp1', label:'Security / Satpam Profesional (sertifikat profesional)'},
  {id:'exp2', label:'Ahli Sertifikat K3 Umum'},
  {id:'exp3', label:'Ahli Sertifikat K3 Konstruksi'},
  {id:'exp4', label:'Ahli Sertifikat K3 Kimia'},
  {id:'exp5', label:'Ahli Sertifikat K3 Listrik'},
  {id:'exp6', label:'Ahli Sertifikat K3 Manufaktur'},
  {id:'exp7', label:'Ahli Sertifikat K3 Minyak dan Gas'},
  {id:'exp8', label:'Ahli Sertifikat Fire Safety / Pemadam Kebakaran'},
  {id:'exp9', label:'Ahli Sertifikat Auditor SMK3'},
  {id:'exp10', label:'Ahli Sertifikat K3 Pertambangan'},
  {id:'exp11', label:'Team Forensik INAFIS'},
  /* added */
  {id:'exp12', label:'Ahli Environmental & Lingkungan Hidup'},
  {id:'exp13', label:'Ahli Arsitek'},
  {id:'exp14', label:'Ahli Insinyur Sipil / Struktural (Site Engineer)'},
  {id:'exp15', label:'Konsultan Pengawas (Construction Management)'},
  {id:'exp16', label:'Konsultan Struktur'},
  {id:'exp17', label:'Konsultan Mekanikal & Elektrikal (M&E)'},
  {id:'exp18', label:'Quantity Surveyor (QS)'},
  {id:'exp19', label:'Ahli Tenaga Kerja Bangunan Tinggi (TKBT) level 1 & 2'},
  {id:'exp20', label:'Ahli Tenaga Kerja Pada Ketinggian (TKPK) level 1,2 & 3'},
  {id:'exp21', label:'Ahli K3 Spesialis Penanggulangan Kebakaran Tingkat A (Firefighting Level A)'}
];

/* render expert checkboxes */
const grid = document.getElementById('expertsGrid');
EXPERTS.forEach(e=>{
  const wrapper = document.createElement('label');
  wrapper.className = 'expert';
  wrapper.title = e.label;
  const cb = document.createElement('input');
  cb.type = 'checkbox'; cb.id = e.id; cb.value = e.label;
  const span = document.createElement('span'); span.textContent = e.label;
  wrapper.appendChild(cb); wrapper.appendChild(span);
  grid.appendChild(wrapper);
});

/* DOM references */
const cameraInput = document.getElementById('cameraInput');
const galleryInput = document.getElementById('galleryInput');
const preview = document.getElementById('preview');
const latEl = document.getElementById('lat');
const lonEl = document.getElementById('lon');
const tsEl = document.getElementById('timestamp');
const placeEl = document.getElementById('place');
const noteEl = document.getElementById('note');
const getGeoBtn = document.getElementById('getGeoBtn');
const clearImageBtn = document.getElementById('clearImageBtn');

const generateBtn = document.getElementById('generateBtn');
const genExampleBtn = document.getElementById('genExampleBtn');
const copyPromptBtn = document.getElementById('copyPromptBtn');
const copyExampleBtn = document.getElementById('copyExampleBtn');
const downloadBtn = document.getElementById('downloadBtn');
const promptOutput = document.getElementById('promptOutput');
const exampleOutput = document.getElementById('exampleOutput');
const speakExampleBtn = document.getElementById('speakExampleBtn');

let lastFile = null;

/* file handlers - camera and gallery both set lastFile and preview */
cameraInput.addEventListener('change', handleFileSelection);
galleryInput.addEventListener('change', handleFileSelection);

function handleFileSelection(e){
  const f = e.target.files[0];
  if(!f) return;
  lastFile = f;
  const url = URL.createObjectURL(f);
  preview.src = url; preview.style.display = 'block';
  // try EXIF extraction if exif-js loaded
  try {
    if(window.EXIF && EXIF.getData){
      EXIF.getData(f, function(){
        const lat = EXIF.getTag(this,'GPSLatitude');
        const lon = EXIF.getTag(this,'GPSLongitude');
        const latRef = EXIF.getTag(this,'GPSLatitudeRef');
        const lonRef = EXIF.getTag(this,'GPSLongitudeRef');
        const dt = EXIF.getTag(this,'DateTimeOriginal') || EXIF.getTag(this,'DateTime');
        if(lat && lon){
          latEl.value = dmsToDeg(lat, latRef);
          lonEl.value = dmsToDeg(lon, lonRef);
        }
        if(dt) tsEl.value = dt.replace(/^(\d{4}):(\d{2}):(\d{2})/,'$1-$2-$3');
      });
      return;
    }
  } catch(err){
    console.warn('EXIF parse failed', err);
  }
  // fallback: set timestamp now
  tsEl.value = new Date().toISOString();
}

/* convert DMS to decimal */
function dmsToDeg(dms, ref){
  try {
    const d = dms[0].numerator / dms[0].denominator;
    const m = dms[1].numerator / dms[1].denominator;
    const s = dms[2].numerator / dms[2].denominator;
    let dd = d + m/60 + s/3600;
    if(ref==='S' || ref==='W') dd = -dd;
    return dd.toFixed(6);
  } catch(e){ return ''; }
}

/* geolocation fallback */
getGeoBtn.addEventListener('click', ()=>{
  if(!navigator.geolocation) return alert('Geolocation tidak didukung browser ini.');
  getGeoBtn.textContent = 'Mencari lokasi...';
  navigator.geolocation.getCurrentPosition(pos=>{
    latEl.value = pos.coords.latitude.toFixed(6);
    lonEl.value = pos.coords.longitude.toFixed(6);
    getGeoBtn.textContent = 'Ambil GPS Perangkat';
  }, err=>{
    getGeoBtn.textContent = 'Ambil GPS Perangkat';
    alert('Gagal ambil GPS: '+ err.message);
  }, {enableHighAccuracy:true, timeout:8000});
});

/* clear image */
clearImageBtn.addEventListener('click', ()=>{
  lastFile = null;
  preview.src = ''; preview.style.display = 'none';
  tsEl.value=''; latEl.value=''; lonEl.value=''; placeEl.value='';
});

/* build prompt */
function buildPrompt(){
  const selected = EXPERTS.filter(e => document.getElementById(e.id).checked).map(e=>e.label);
  const expertBlock = selected.length ? selected.join('; ') : 'Perspektif umum security (satpam/professional).';

  const ctx = {
    timestamp: tsEl.value || new Date().toISOString(),
    lat: latEl.value || null,
    lon: lonEl.value || null,
    place: placeEl.value || '',
    notes: noteEl.value || '',
    imageAttached: !!lastFile
  };

  let p = '';
  p += `KONTEKS:\n`;
  p += `- Timestamp: ${ctx.timestamp}\n`;
  if(ctx.lat && ctx.lon) p += `- Koordinat: ${ctx.lat}, ${ctx.lon}\n`;
  if(ctx.place) p += `- Nama/Label Lokasi: ${ctx.place}\n`;
  p += `- Gambar terlampir: ${ctx.imageAttached ? 'Ya (user mengunggah foto)' : 'Tidak'}\n`;
  if(ctx.notes) p += `- Catatan tambahan: ${ctx.notes}\n`;
  p += `\nINSTRUKSI UMUM UNTUK AI:\n`;
  p += `Anda berperan sebagai kumpulan ahli berikut: ${expertBlock}\n\n`;
  p += `Tugas: Berikan output berbahasa Indonesia yang sangat praktis, terstruktur, dan step-by-step:\n`;
  p += `1) 'Analisa per Ahli': untuk setiap ahli yang dipilih, tulis 2-4 kalimat analisa risiko dan prioritas dari perspektif ahli tersebut.\n`;
  p += `2) 'SOP Step-by-Step' (Checklist bernomor) yang bisa langsung diikuti oleh petugas/satpam di lapangan. Prioritaskan tindakan keselamatan dan dokumentasi bukti.\n`;
  p += `3) 'Protap (Prosedur Tetap)': langkah jangka panjang untuk mencegah insiden serupa.\n`;
  p += `4) 'Eskalasi Darurat': langkah yang harus dilakukan jika ditemukan bahaya (kebakaran, bahan kimia, senjata, kekerasan), termasuk kontak yang direkomendasikan.\n`;
  p += `5) 'Decision Checklist' 5-poin yang ringkas untuk petugas.\n\n`;
  p += `Tambahkan catatan 'Confidence & Verifikasi' jika data (mis. GPS atau identitas) tidak lengkap. Jika ada gambar, sebutkan bahwa rekomendasi didasarkan pada analisa foto dan mintalah verifikasi lapangan.\n\n`;
  p += `OUTPUT harus menggunakan heading seperti: "Analisa per Ahli", "SOP Step-by-Step", "Protap", "Eskalasi Darurat", "Decision Checklist". Gunakan bahasa jelas, singkat, dan actionable.\n`;
  return p;
}

/* generate prompt */
generateBtn.addEventListener('click', ()=>{
  const p = buildPrompt();
  promptOutput.value = p;
  // auto scroll to right column
  window.scrollTo({top:0, behavior:'smooth'});
});

/* generate mocked example output (simple template) */
genExampleBtn.addEventListener('click', ()=>{
  const selected = EXPERTS.filter(e=>document.getElementById(e.id).checked).map(e=>e.label);
  const place = placeEl.value || 'Lokasi tidak bernama';
  const ts = tsEl.value || new Date().toISOString();
  // build simple mock
  let out = '';
  out += `Analisa per Ahli (ringkasan):\n`;
  if(selected.length===0){
    out += `- Security Professional: Area tampak berisiko; verifikasi identitas dan gunakan perekaman.\n`;
  } else {
    selected.forEach(label=>{
      out += `- ${label}: Berikan analisa spesifik (contoh singkat) berdasarkan kondisi lapangan.\n`;
    });
  }
  out += `\nSOP Step-by-Step (Prioritas):\n`;
  out += `1. Amankan area dan posisikan petugas pada jarak aman.\n`;
  out += `2. Rekam bukti (foto/30s video) dan ambil ID/plat kendaraan jika aman.\n`;
  out += `3. Jika terjadi kehadiran mencurigakan pada malam hari, hubungi patroli/koordinasi dengan security supervisor.\n`;
  out += `4. Jika terdeteksi bahan berbahaya / api / ancaman serius â†’ evakuasi & hubungi layanan darurat.\n`;
  out += `5. Catat semua bukti dan upload/arsip ke log insiden.\n\n`;
  out += `Protap (Prosedur Tetap):\n`;
  out += `- Jadwalkan patroli tambahan, perbaiki penerangan, pasang CCTV di sudut rawan, buat SOP verifikasi identitas kendaraan.\n\n`;
  out += `Eskalasi Darurat:\n`;
  out += `- Jika ada api / asap â†’ hubungi pemadam kebakaran.\n`;
  out += `- Jika ada bahan kimia â†’ amanankan area & panggil tim K3 kimia.\n\n`;
  out += `Decision Checklist (5 poin):\n`;
  out += `1) Apakah area aman untuk mendekat? 2) Sudah merekam bukti? 3) Apakah identitas diverifikasi? 4) Butuh backup? 5) Perlu lapor ke otoritas?\n\n`;
  out += `---\nSumber: Analisa mock berdasarkan gambar & metadata (${place}, ${ts}). Mohon verifikasi lapangan sebelum tindakan kritis.`;
  exampleOutput.value = out;
});

/* copy prompt */
copyPromptBtn.addEventListener('click', ()=>{
  const t = promptOutput;
  if(!t.value) return alert('Tidak ada prompt untuk disalin. Tekan Generate Prompt dahulu.');
  t.select(); document.execCommand('copy'); alert('Prompt disalin ke clipboard.');
});

/* copy example */
copyExampleBtn.addEventListener('click', ()=>{
  const t = exampleOutput;
  if(!t.value) return alert('Tidak ada contoh untuk disalin. Tekan Generate Example Output dahulu.');
  t.select(); document.execCommand('copy'); alert('Contoh SOP disalin.');
});

/* download prompt as .txt */
downloadBtn.addEventListener('click', ()=>{
  const text = promptOutput.value || '';
  if(!text){ alert('Tidak ada prompt untuk di-download.'); return; }
  const blob = new Blob([text], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'security_prompt.txt'; a.click();
  URL.revokeObjectURL(url);
});

/* TTS for example */
speakExampleBtn.addEventListener('click', ()=>{
  const txt = exampleOutput.value;
  if(!txt) return alert('Tidak ada contoh untuk dibacakan.');
  if(!('speechSynthesis' in window)) return alert('Browser tidak mendukung Text-to-Speech.');
  const ut = new SpeechSynthesisUtterance(txt);
  ut.lang = 'id-ID';
  window.speechSynthesis.speak(ut);
});

/* small UX: allow clicking expert card to toggle checkbox */
document.querySelectorAll('.expert').forEach(card=>{
  card.addEventListener('click', (e)=>{
    if(e.target.tagName === 'INPUT') return; // native click
    const cb = card.querySelector('input[type="checkbox"]');
    cb.checked = !cb.checked;
  });
});

/* initial note: try to load EXIF lib (already included) */
if(window.EXIF) console.log('EXIF ready');

/* end of script */
</script>
</body>
</html>
